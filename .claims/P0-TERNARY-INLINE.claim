# P0-TERNARY-INLINE: Ternary Expression Inlining Fails
**Status:** ✅ COMPLETED
**Claimed:** Dec 24, 2025
**Completed:** Dec 25, 2025
**Agent:** Claude Opus 4.5

## Issue
Ternary expressions not properly inlined - condition stored in temp variable, result variable undefined.

## Example (Before Fix)
```java
// Dexterity (WRONG):
z = inputStreamReader instanceof BufferedReader;
BufferedReader r3 = z ? (BufferedReader)inputStreamReader : new BufferedReader(inputStreamReader, i);
return TextStreamsKt.readText(obj);  // obj UNDEFINED!
```

## Solution Applied

### Fix 1: Add InstanceOf to process_block_prelude_for_inlining
**Location:** `crates/dexterity-codegen/src/body_gen.rs` line 8331

Added handler for `InsnType::InstanceOf` in `process_block_prelude_for_inlining()`.
Previously the function handled Const, Move, Binary, Cast, etc. but NOT InstanceOf.
Now InstanceOf expressions are stored for inlining when single-use.

### Fix 2: Store ternary result for inlining
**Location:** `crates/dexterity-codegen/src/body_gen.rs` line 7739

After emitting TernaryAssignment declaration, now stores the result for inlining.
This allows `return r3;` to become `return (cond ? then : else);` when r3 is single-use.

## Result (After Fix)
```java
// Dexterity (CORRECT):
publisher = publisher instanceof Publisher ? (Publisher)publisher : new FlowAdapters.ReactivePublisherFromFlow(publisher);
```

## Tests
- All cargo tests pass ✅
- medium.apk decompilation verified ✅
- instanceof ternary patterns correctly inlined ✅
