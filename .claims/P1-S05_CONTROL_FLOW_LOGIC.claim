# P1-S05: Control Flow Logic Wrong
Claimed: 2025-12-21
Agent: Claude Opus 4.5 (claude-opus-4-5-20251101)

## Task
Fix control flow logic issues where variables become undefined and expressions aren't inlined properly.

## Example Method
`com/amplitude/api/f.java:D(long j)`

## Root Causes (from investigation)
1. Variable Naming Corruption - `l2` and `j_2` malformed
2. Undefined Variable `l2` - field access not inlined
3. Ternary Extraction - extracted to separate statement instead of inline
4. SSA Version Mismatch - returns wrong variable
5. Expression Not Inlined - `return a - b < ternary` decomposed into multiple statements

## Files Modified
- body_gen.rs (Dec 21, 2025)

## Progress (Dec 21, 2025)

### Fixed: Field Access Inlining
- InstanceGet now checks `should_inline()` and stores expression inline for single-use variables
- StaticGet now checks `should_inline()` and stores expression inline for single-use variables
- Ternary instruction now uses `gen_arg_inline()` for all sub-expressions (condition, then, else)

### Remaining Issues
The example method still has problems because of deeper issues:
1. **Type Inference**: Ternary result typed as `Object` instead of `long` - needs fix in type_inference.rs
2. **SSA Variable Naming**: Variables like `l2` created but never defined - needs investigation in var_naming.rs
3. **Return Value Tracking**: Returns wrong variable `j2` instead of comparison result

### JADX vs Dexterity Comparison
**JADX (correct):**
```java
private boolean D(long j2) {
    long j3 = this.H ? this.D : this.E;
    long j4 = j2 - this.w;
    return j4 < j3;
}
```

**Dexterity (still wrong):**
```java
private boolean D(long j) {
    long l;
    int j2 = 0;
    Object obj0 = this.H ? this.D : this.E;
    j -= l2;
    j = j < l ? 1 : 0;
    return j2;
}
```

## Status
PARTIAL - Field inlining improved, type inference issues remain
