**Status:** COMPLETED
**Fixed:** Dec 20, 2025
**Verified:** Dec 25, 2025

## Issue: BUG-001 - Undefined Switch Variable `i`

Problem: Switch map synthetic classes (AnonymousClass1, etc.) were not being generated.
When decompiled code references switch tables, it used an undefined variable `i`.

FIX APPLIED:

Root Cause Identified:
- In add_nested_inner_classes(), anonymous classes were being skipped (line 729-732 original)
- Switch map synthetic classes like Keys$1 contain $SwitchMap$ fields but were being skipped
  because is_anonymous_class() returned true for them
- Additionally, type references used invalid Java syntax like "Keys.1" instead of "Keys.AnonymousClass1"

Solution Implemented:
1. Added is_switch_map_class() function in class_gen.rs to detect switch map synthetic classes
   - Checks for anonymous class pattern (Outer$1) OR WhenMappings class
   - Verifies class has $SwitchMap$* or $EnumSwitchMapping$* fields in static_fields

2. Modified add_nested_inner_classes() to NOT skip switch map classes
   - Changed: if is_anonymous_class() { continue; }
   - To: if is_anonymous_class() && !is_switch_map_class() { continue; }

3. Updated get_inner_class_simple_name() to prefix digit-starting names with "AnonymousClass"
   - "1" from "$1" becomes "AnonymousClass1"
   - Makes class names valid Java identifiers

4. Updated replace_inner_class_separator() in dex_info.rs
   - When converting $ to ., detects if next part starts with digit
   - Adds "AnonymousClass" prefix: Keys$1 -> Keys.AnonymousClass1

Files Changed:
- crates/dexterity-codegen/src/class_gen.rs (is_switch_map_class, get_inner_class_simple_name, add_nested_inner_classes)
- crates/dexterity-codegen/src/dex_info.rs (replace_inner_class_separator)
- crates/dexterity-codegen/src/lib.rs (export is_switch_map_class)

Result:
- 24 switch map synthetic classes now generated in large APK (was 0 before)
- References use valid Java syntax: Keys.AnonymousClass1.$SwitchMap$...
- All codegen tests pass (102/102)


## Verification
- All 114 codegen tests pass
- Fix verified in: `crates/dexterity-codegen/src/class_gen.rs:186` (is_switch_map_class function)
- Usage verified at line 937: `if is_anonymous_class(&inner_class.class_type) && !is_switch_map_class(inner_class)`
