# P0-UNDEF-VAR: Undefined Variables in Complex Expressions
**Status:** ✅ COMPLETE
**Agent:** Claude Opus 4.5
**Date:** Dec 25, 2025
**Commit:** ff104b879

## Issue
Undefined variables like `mODEL2`, `mANUFACTURER2`, `z` appeared in decompiled code.

## Root Cause
Static field accesses (SGET) used an unreliable heuristic (`contains('.')`) for inlining decisions. Different code paths made inconsistent decisions about whether to inline, sometimes assigning variable names that were never declared.

## Solution Applied (Clone of JADX approach)

### 1. Definitive Flag for Static Fields
```rust
// Added to BodyGenContext
static_field_vars: HashSet<(u16, u32)>  // Mark SGET results definitively
```

### 2. must_inline() Method
```rust
fn must_inline(&self, reg: u16, version: u32) -> bool {
    self.force_inline_vars.contains(&(reg, version)) ||
    self.static_field_vars.contains(&(reg, version))
}
```

### 3. SGET Instruction Handling
```rust
// In SGET handler:
ctx.static_field_vars.insert((dest.reg_num, dest.ssa_version));
```

### 4. Updated Inline Methods
- `gen_arg_inline()` - checks `must_inline()` instead of heuristic
- `gen_arg_inline_peek()` - checks `must_inline()` instead of heuristic
- `gen_arg_inline_typed()` - checks `must_inline()` instead of heuristic

## Sub-Issues Fixed

### Issue 1: Ternary Constructor Const Inlining (8192 literal) ✅
- Moved `process_block_prelude_for_inlining()` to top of function
- Result: `new BufferedReader(inputStreamReader, 8192)` correctly inlines

### Issue 2: Force-Inline for Ternary Results (`obj`) ✅
- Added `force_inline_vars` HashSet
- Added `store_inline_expr_forced()` method
- Result: Ternary results correctly inline

### Issue 3: Static Field Aliases (`mODEL2`, `hARDWARE2`) ✅
- Added `static_field_vars` HashSet for SGET results
- Added `must_inline()` method
- Result: Static fields consistently inlined, no more undefined variables

## Results
- ✅ No more undefined variables in decompiled output
- ✅ Build compiles successfully
- ✅ All integration tests pass
- ✅ Verified with badboy-x86.apk decompilation

## Files Modified
- `crates/dexterity-codegen/src/body_gen.rs`

## JADX Reference
- `InsnGen.java:491-492` - Static field inlining pattern
- `CodeShrinkVisitor.java` - FORCE_ASSIGN_INLINE flag
