# P0-EXCEPTION-SCOPE: Exception Variable Scope
**Status:** COMPLETED âœ…
**Agent:** Claude Opus 4.5
**Date:** Dec 27, 2025

## Issue
Exception variable `th` used outside catch block in synchronized.

**Example from Util.java:63-66 (BEFORE):**
```java
synchronized (sHA_256_CHARS2) {
    try {
        return Util.bytesToHex(bArr, sHA_256_CHARS2);
    } catch (Throwable th) {
    }
    /* Dexterity WARN: Type inference failed for thrown value */
    throw (Throwable) th;  // ERROR: th out of scope
}
```

**Fixed output (AFTER):**
```java
synchronized (sHA_256_CHARS2) {
    return Util.bytesToHex(bArr, sHA_256_CHARS2);
}
```

## Root Cause
The compiler generates synthetic exception handlers for synchronized blocks to ensure
`monitor-exit` runs even when exceptions occur. The handler structure is:
- Handler block: `move-exception` only
- Successor block (not dominated): `throw`

The `is_synthetic_rethrow_handler` function only checked if `throw` was in the handler
blocks, but the throw was in a non-dominated successor block.

## Fix Applied
Updated `is_synthetic_rethrow_handler()` in `region_builder.rs`:
1. If handler has no meaningful instructions (other_insn_count == 0), filter it
2. This catches both cases:
   - Handler has throw but no other code (original check)
   - Handler only has move-exception (throw in successor - NEW)
3. Count Nop instructions as "other" to avoid filtering real finally handlers

## Files Changed
- `crates/dexterity-passes/src/region_builder.rs`: Lines 868-945 (`is_synthetic_rethrow_handler` function)

## Verification
- 414 tests pass
- Generated output verified: synthetic try-catch eliminated from synchronized blocks
- Exception variable scoping error resolved
