# GAP-7: tryToFixIncompatiblePrimitives() with Instruction Splitting
**Status:** ✅ COMPLETE
**Agent:** Claude Opus 4.5
**Date:** Dec 27, 2025

## Issue
Dexterity's `try_to_fix_incompatible_primitives()` only updates resolved types in-place. JADX's version can split instructions and re-run type inference.

**Current Behavior (Dexterity):**
- Only updates resolved types in-place at fix_types.rs:366-399
- Doesn't split instructions when primitive types conflict
- Boolean/int conflicts not fully resolved

**Expected (JADX):**
- `FixTypesVisitor.java:681-698` - `processIncompatiblePrimitives()` can split instructions
- Re-runs `InitCodeVariables.rerun()` after splitting
- Re-initializes type bounds for correct inference

## JADX Reference
- `jadx-core/src/main/java/jadx/core/dex/visitors/typeinference/FixTypesVisitor.java:681-808`
- `jadx-core/src/main/java/jadx/core/dex/visitors/InitCodeVariables.java:32-37` (rerun pattern)

## Dexterity Location
- `crates/dexterity-passes/src/fix_types.rs:366-399`

## Solution Implemented
Instead of modifying IR with instruction splitting (which would require GAP-10 rerun pattern),
implemented at codegen level - simpler and equally effective:

**Files Modified:**
- `crates/dexterity-ir/src/types.rs` - Added `is_numeric()` method to ArgType
- `crates/dexterity-codegen/src/body_gen.rs` - Added boolean→numeric conversion in two places

**Approach:**
- When generating code where target type is numeric and source is boolean:
  - Boolean literals `true`/`false` → emit `1`/`0` directly
  - Boolean expressions → emit `(expr) ? 1 : 0` ternary conversion
- This matches JADX's `fixBooleanUsage()` semantics without IR modification

**Testing:**
- All 680+ integration tests pass
- Verified with badboy-x86.apk decompilation
- Before: `ComponentActivityKt.setContent$default(..., (true) ? 1 : 0, ...)`
- After: `ComponentActivityKt.setContent$default(..., 1, ...)`
