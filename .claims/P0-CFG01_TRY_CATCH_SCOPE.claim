P0-CFG01: Try-catch exception variable scope corruption
Status: PARTIAL_FIX (deeper issues found)
Started: Mon Dec 22 03:24:25 PM PST 2025
Last Update: Mon Dec 22 04:20:00 PM PST 2025
Agent: Claude Opus 4.5

Issue: Exception handler variable scope resolution failure in CFG decompilation.
Exception block code was being placed in try block instead of catch block.

Root Cause Analysis (Updated):
1. Original issue: Handler blocks with addresses within the try address range were
   being included in try_block_ids.
2. Fixed: collect_handler_blocks_by_dominance() was filtering OUT blocks in
   try_block_ids during collection (lines 495-497, 514). This is now fixed.
3. DEEPER ISSUE FOUND: Even with correct region structure, the code generation
   produces incorrect output:
   - Exception variable `th` assigned from wrong source (this.b instead of catch)
   - Type confusion: Throwable assigned from field of type `f`
   - Method calls on wrong types (e.g., th.c when th is Throwable)
   - This appears to be an SSA/variable resolution issue in code generation,
     NOT a region structure issue.

Fixes Applied to region_builder.rs:
1. collect_handler_blocks_by_dominance() no longer filters by try_blocks
   (lines 508, 513-516, 530-531 modified)
2. Handler entry addresses removed from try_block_ids before collection (360-363)
3. All handler blocks removed from try_block_ids after collection (400-403)

These fixes are CORRECT for the region structure issue, but the visible bug
(garbled code in try block, empty catch block) has a different root cause
in code generation/SSA variable resolution.

Next Steps (for another agent):
- Investigate body_gen.rs exception handler variable tracking
- Check find_move_exception_dest and how exc_var is linked to registers
- Verify SSA variable naming across try/catch boundaries
- The issue may be in ExpressionGenerator or BodyGenContext exception handling

Files Modified:
- crates/dexterity-passes/src/region_builder.rs (lines 353-404, 499-531)

Test Status:
- Build succeeds
- Integration tests blocked by unrelated changes (SsaResult field additions)
